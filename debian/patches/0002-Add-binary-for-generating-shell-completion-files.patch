From: nabijaczleweli <nabijaczleweli@gmail.com>
Date: Sun, 23 Feb 2020 15:17:42 +0100
Subject: Add binary for generating shell completion files

---
 Cargo.toml                    |  6 ++++++
 src/http-build-completions.rs | 21 +++++++++++++++++++++
 src/options.rs                | 10 +++++++---
 3 files changed, 34 insertions(+), 3 deletions(-)
 create mode 100755 src/http-build-completions.rs

diff --git a/Cargo.toml b/Cargo.toml
index d6dc3da..70c933e 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -71,6 +71,12 @@ path = "src/main.rs"
 test = false
 doc = false
 
+[[bin]]
+name = "http-build-completions"
+path = "src/http-build-completions.rs"
+test = false
+doc = false
+
 
 [package.metadata.deb]
 name = "http"
diff --git a/src/http-build-completions.rs b/src/http-build-completions.rs
new file mode 100755
index 0000000..f1be2ad
--- /dev/null
+++ b/src/http-build-completions.rs
@@ -0,0 +1,21 @@
+#[macro_use]
+extern crate lazy_static;
+extern crate regex;
+#[macro_use]
+extern crate clap;
+
+mod options;
+
+pub use options::{Options, LogLevel};
+
+use clap::Shell;
+
+
+fn main() {
+    let mut app = Options::app();
+    for &shell in &[Shell::Bash, Shell::Zsh, Shell::Fish] {
+        for &bin in &["http", "httplz"] {
+            app.gen_completions(bin, shell, ".");
+        }
+    }
+}
diff --git a/src/options.rs b/src/options.rs
index 63d3397..52a8eb7 100644
--- a/src/options.rs
+++ b/src/options.rs
@@ -74,9 +74,8 @@ pub struct Options {
 }
 
 impl Options {
-    /// Parse `env`-wide command-line arguments into an `Options` instance
-    pub fn parse() -> Options {
-        let matches = App::new("http")
+    pub fn app() -> App<'static, 'static> {
+        App::new("http")
             .version(crate_version!())
             .author(crate_authors!("\n"))
             .about(crate_description!())
@@ -103,6 +102,11 @@ impl Options {
             .arg(Arg::from_usage("--path-auth [PATH=[USERNAME[:PASSWORD]]]... 'Data for authentication under PATH'")
                 .validator(Options::path_credentials_validator))
             .arg(Arg::from_usage("--gen-path-auth [PATH]... 'Generate a one-off username:password set for authentication under PATH'"))
+    }
+
+    /// Parse `env`-wide command-line arguments into an `Options` instance
+    pub fn parse() -> Options {
+        let matches = Options::app()
             .get_matches();
 
         let dir = matches.value_of("DIR").unwrap_or(".");
